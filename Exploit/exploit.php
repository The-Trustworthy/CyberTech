<?php

    ////////////////////////////////////////////////////////////////////////

    // Define your PHP function
    function deleteFile($filename) {        
        if (file_exists($filename)) {
            if (unlink($filename)) {
                echo "File '$filename' has been deleted.";
            } else {
                echo "Error deleting the file.";
            }
        } else {
            echo "File '$filename' does not exist.";
        }
        // Your PHP code here
        echo "PHP function called!";
    }

    ////////////////////////////////////////////////////////////////////////

    $data = json_decode(file_get_contents('php://input'), true);

    $deleteFile = $data['deleteFile'];
    $filename = $data['filePath'];

    // Now you can use $variable1, $variable2, and $variable3 as needed
    if ($deleteFile) {
        echo "printing var deleteFile: $filename";
        deleteFile($filename); // Call the PHP function
        exit; // Terminate further PHP execution
    } 

?>

<html lang="en" dir="ltr"><head>
    <meta charset="utf-8">
    <title>Secret</title>
    <style>
        h1, h2, h3, h4, h5, h6 {
            font-weight: normal;
            font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
            color: #b5e853;
            letter-spacing: -0.03em;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1), 0 0 5px rgba(181,232,83,0.1), 0 0 10px rgba(181,232,83,0.1);
        }
        body {
            margin: 0;
            padding: 0;
            background-image: url('https://i.imgur.com/5rZ91h5.gif');
            color: #eaeaea;
            font-size: 14px;
            line-height: 1.5;
            font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace;
        }
        #submitBtn {
            background: rgba(201,32,0,0.7) !important;
            border: 1px solid rgba(255,255,255,0.15);
            padding: 0px 3px;
            margin: 0px -3px;
            color: #aa759f;
            border-radius: 12px;

        }
        input {
            display: inline-block;
            text-align: center;
            margin: 0;
            padding: 8px 18px;
            border-radius: 50px;
            font-size: large;
        }
        #submitBtn {
            display: inline-block;
            background: -webkit-linear-gradient(top, rgba(60,60,60,0.3), rgba(35,35,35,0.8) 50%, rgba(10,10,10,0.8) 50%, rgba(0,0,0,0.8));
            padding: 8px 18px;
            border-radius: 50px;
            border: 2px solid rgba(0,0,0,0.7);
            border-bottom: 2px solid rgba(0,0,0,0.7);
            border-top: 2px solid #000;
            color: rgba(255,255,255,0.8);
            font-family: Helvetica, Arial, sans-serif;
            font-weight: bold;
            font-size: 14px;
            text-decoration: none;
            text-shadow: 0 -1px 0 rgba(0,0,0,0.75);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
            width: 20%;
            height: 4%;
        }
        #submitBtn:hover {
            background: -webkit-linear-gradient(top, rgba(40,40,40,0.6), rgba(35,35,35,0.6) 50%, rgba(10,10,10,0.8) 50%, rgba(0,0,0,0.8));
        }

        .dirlist {
            color: white;
            width: 70%;
            margin: 5% 15%;
            text-align: left;
            font-size: large;
            padding: 1%;
            background: rgba(0,0,0,0.6);
        }
        input#fileName {
            width: 50%;
            height: 4%;
        }
    </style>

    <script type="text/javascript">

        function deleteFile() {
            var fName = document.getElementById('fileName').value;
            var baseURL = "./";
            var url = baseURL + fName; 
            var xhr = new XMLHttpRequest();
            
            // Create an object to hold the data
            var data = {
                deleteFile: 'true',
                filePath: url
            };

            xhr.open('POST', '', true);
            xhr.setRequestHeader('Content-Type', 'application/json'); // Set the content type to JSON

            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Handle the response from the server if needed
                    console.log(xhr.responseText);
                }
            };

            // Convert the data object to a JSON string and send it in the request body
            xhr.send(JSON.stringify(data));
            location.reload();

            // var des = "Deleting " + fName + "...";
            // alert(des);
        }

        ////////////////////////////////////////////////////////////////////////////

        function downloadFile(url, ipName) {
            var filename = ipName;
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", filename);
            link.setAttribute("target", "_blank");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            var retVal = "Downloaded " + filename;
            return retVal;
        }
  
        function downloadRes() {
            var fName = document.getElementById('fileName').value;
            var baseURL = "./";
            var url = baseURL + fName;
            
            console.log(url);
            var res = downloadFile(url, fName);
            console.log(res);
            location.reload();
            alert(res);
        }
        
      </script>
  </head>

  <body>
    <center>
    <br /><br />
    <h1><u>List of Uploaded Files</u></h1>
      
     <div class="dirlist">
        <?php

            // Get the current directory
            $directory = getcwd();

            // List all files in the current directory
            $files = scandir($directory);

            // Loop through the files and display them
            foreach ($files as $file) {
                // Exclude "." and ".." directories
                if ($file != "." && $file != "..") {
                    echo $file . "<br>";
                }
            }

        ?>
    </div> <br /><br />
      <div class="form secret">
      <form class="" id="form" type="POST" action="./">
          <legend>
          <input type="text" id="fileName" name="fileName" value="" placeholder="Enter  the name of a file from the list."> <br /><br />
          <input type="button" id="submitBtn" name="submit" value="Download" onclick="downloadRes()">
          <input type="button" id="submitBtn" name="submit" value="Delete" onclick="deleteFile()">
          </legend>
      </form>
      </div>
    </center>
  
</body></html>
